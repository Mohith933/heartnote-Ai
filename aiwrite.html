<!DOCTYPE html>  
<html lang="en">  
<head>  
  <meta charset="utf-8" />  
  <meta name="viewport" content="width=device-width,initial-scale=1" />  
  <title>HeartNote AI ‚Äî H1 (Creative Writer)</title>  
  
  <!-- Quicksand (Google Fonts) -->  
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">  
  <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@400;600&display=swap" rel="stylesheet">  
  
  <style>  
    
    /* Dark mode theme */
@media (prefers-color-scheme: dark) {
  :root{  
      --bg: #fff;  
      --text:#000;
      --accent:  #ff4d6d;  
      --muted: #e63950;  
--card: rgba(255,255,255,0.04);  
--glass: rgba(255,255,255,0.03);  
    } 
}

body.dark {
  --bg: #0e0e0f;
  --text: #f9f9fb;
  --accent: #ff5c8d;
  --muted: #ff7da3;
  --option:#000;
  --card: rgba(255, 255, 255, 0.04);
  --glass: rgba(255, 255, 255, 0.05);
}
    *{box-sizing:border-box}  
    html,body{height:100%}  
    body{  
      margin:0;  
      font-family: 'Inter', sans-serif;  
      background:var(--bg);  
      color: var(--text);  
      -webkit-font-smoothing:antialiased;  
      -moz-osx-font-smoothing:grayscale;  
      display:flex;  
      align-items:flex-start;  
      justify-content:center;  
      padding:28px;  
      gap:20px;  
    }  
    body { scroll-behavior: smooth; -webkit-overflow-scrolling: touch; }  
  
    /* Layout container */  
    .app {  
      width:100%;  
      max-width:100%;  
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));  
      border-radius:14px;  
      padding-left: 0px;  
      padding-top: 5px;  
      padding-right: 0px;  
      overflow:hidden;  
    }  
    .app { opacity:0; animation: fadeInApp 0.8s ease forwards; }  
@keyframes fadeInApp { to { opacity:1; } }  
  
    /* Header */  
    .header {  
      display:flex;  
      align-items:center;  
      justify-content:space-between;  
      gap:12px;  
    }  
    .brand {  
      display:flex;  
      align-items:center;  
      gap:12px;  
      font-weight:700;  
      font-size:1.25rem;  
    }  
    .brand .heart {  
      background: rgba(255,255,255,0.06);  
      padding:8px;  
      border-radius:10px;  
      font-size:1.05rem;  
    }  
    .header .actions {  
      display:flex;  
      gap:10px;  
    }  
    .btn {  
      background:var(--accent);  
      border:none;  
      color:#fff;  
      padding:8px 12px;  
      border-radius:10px;  
      cursor:pointer;  
      font-weight:600;  
      font-size:0.95rem;  
      transition:transform .12s ease, box-shadow .12s ease;  
    }  
    .btn:hover{ background: #F06292; transform: scale(1.05);box-shadow:0 8px 18px rgba(186,23,74,0.18) }  
  
    /* Main grid */  
    .grid {  
      display:grid;  
      grid-template-columns: 1fr 420px;  
      gap:18px;  
      margin-top:18px;  
    }  
  
    /* Left column: controls + output */  
    .panel {  
      background:var(--card);  
     backdrop-filter: blur(10px);  
     border: 1px solid rgba(255, 77, 109, 0.2);  
      padding:16px;  
      border-radius:12px;  
      backface-visibility:hidden;  
    }  
  
    label { display:block; margin-bottom:6px; color:var(--accent); font-weight:600; font-size:0.9rem; }  
  
    .controls { display:flex; gap:10px; align-items:center; flex-wrap:wrap; }  
    select, textarea, input[type="range"] {  
      width:100%;  
      border-radius:10px;  
      backdrop-filter: blur(10px);  
      border: 1px solid rgba(255, 77, 109, 0.2);  
      background:transparent;  
      color: var(--text);  
      padding:10px;  
      font-size:0.95rem;  
      outline:none;  
    } 
    option{
      color:var(--option);
    }
    textarea{ min-height:90px; resize:vertical; }  
  
    .small { width:auto; display:inline-flex; gap:8px; align-items:center; }  
  
    .row { display:flex; gap:10px; margin-top:10px; align-items:center; }  
    .row .btn { padding:10px 14px; margin-bottom:20px;}  
  
    /* Handwriting animation */  
@keyframes handwriting {  
  from { stroke-dashoffset: 100%; opacity: 0.6; }  
  to { stroke-dashoffset: 0; opacity: 1; }  
}  
  
.handwriting {  
  font-family: "Caveat", cursive; /* or 'Indie Flower' */  
  font-size: 1.15rem;  
  animation: handwriting 3s ease forwards;  
  white-space: pre-wrap;  
  line-height: 1.8;  
}  
.output pre,  
.output p,  
.output h2 {  
  font-family: "Caveat", cursive !important;  
  font-size: 1.15rem;  
  line-height: 1.8;  
  white-space: pre-wrap;  
}  
  
.output pre,  
.output p {  
  color: var(--text);  
  text-shadow: 0 0 0.6px var(--text);  
}  
  
    /* output */  
    .output {  
      margin-top:14px;  
      background: var(--glass);  
      border: 1px solid rgba(255, 77, 109, 0.2);  
      padding:14px;  
      border-radius:10px;  
      min-height:140px;  
      text-align:left;  
      color:var(--text);  
      line-height:1.5;  
      font-size:1rem;  
      white-space:pre-wrap;  
    }  
  
    .output h2 { margin:0 0 8px 0; font-size:1.05rem; color:var(--text); }  
    .output .meta { font-size:0.85rem; color: var(--text); margin-bottom:8px; }  
  
    .toolbar { display:flex; gap:8px; margin-top:10px; }  
  
    .ghost { background:transparent; border:1px solid #ff4d6d; padding:8px 10px; border-radius:8px; color:#ff4d6d; cursor:pointer; }  
  
    /* History (right column) */  
    .history {  
      background:var(--card);  
      backdrop-filter: blur(10px);  
      border: 1px solid rgba(255, 77, 109, 0.2);  
      padding:12px;  
      border-radius:12px;  
      max-height:560px;  
      overflow:auto;  
    }  
    .history h3{ margin:0 0 8px 0; color:var(--text) }  
    .hist-item {  
      padding:8px;  
      border-radius:8px;  
      background:transparent;  
      display:flex;  
      justify-content:space-between;  
      gap:8px;  
      margin-bottom:8px;  
      border:1px solid rgba(255,255,255,0.03);  
      cursor:pointer;  
    }  
    .hist-item:hover { background: rgba(255,255,255,0.02) }  
  
    .muted { color:var(--text); opacity:0.9; font-size:0.9rem; }  
  
    /* footer small */  
    .footnote {  
      margin-top:12px;  
      font-size:0.82rem;  
      color:var(--text);  
      opacity:0.9;  
    }  
  
    /* responsive */  
    @media (max-width:880px){  
      .grid{ grid-template-columns: 1fr; }  
      .history{ order:2; }  
    }  
    @media (max-width:768px){  
       body{  
        padding-left: 10px;  
        padding-right: 10px;  
        padding-top: 18px;  
      }  
    }  
  
  </style>  
</head>  
<body>  
  <div class="app" role="application" aria-label="HeartNote AI h1">  
    <div class="header">  
      <div class="brand" aria-hidden="true">  
        <div class="heart">üíû</div>  
        <div>  
          <div style="font-size:1.05rem">HeartNote AI</div>    
          <div style="font-size:0.78rem; color:var(--accent); margin-top:4px">
  Personal Writer ‚Äî h1
</div>
        </div>  
      </div>  
  
      <div class="actions">  
        <button class="btn" id="saveAllBtn" title="Save last output">Save</button>  
        <button class="btn" id="copyAllBtn" title="Copy last output">Copy</button>  
        <button class="btn" id="themeToggle" title="Toggle Dark/Light">üåô</button>
      </div>  
    </div>  
  
    <div class="grid">  
      <!-- Left panel -->  
      <div class="panel" aria-live="polite">  
        <label for="mode">Mode</label>  
        <div class="controls">  
          <select id="mode" aria-label="Choose mode">
  <option value="reflection">Reflection</option>
  <option value="journal">Journal</option>
  <option value="note">Note</option>
  <option value="affirmation">Affirmation</option>
  <option value="poem">Poem</option>
  <option value="story">Story</option>
  <option value="letter">Letter</option>
  <option value="quote">Quote</option>
</select>
        </div>  
  
        <label for="prompt" style="margin-top:12px">Prompt (topic / few words)</label>  
        <textarea id="prompt" placeholder="e.g. moonlight love, apology to a friend, product launch"></textarea>  
  
        <div class="row" style="margin-top:12px; align-items:center;">  
          <div style="flex:1">  
            <label for="emotion">Emotion depth</label>  
            <input id="emotion" type="range" min="0" max="100" value="50" />  
            <div class="muted" id="emotionLabel">Balanced</div>  
          </div>  
  
          <div style="width:130px">  
            <label>&nbsp;</label>  
            <button class="btn" id="generateBtn" style="width:100%">Generate</button>  
          </div>  
        </div>  
  
        <div class="output" id="output" tabindex="0" aria-label="Generated output">  
          <div class="meta muted">Your generated content will appear here.</div>  
        </div>  
  
        <div class="toolbar" style="margin-top:8px">  
          <button class="ghost" id="copyBtn">üìã Copy</button>  
          <button class="ghost" id="downloadBtn">‚¨á Save .txt</button>  
          <button class="ghost" id="addHistoryBtn">‚≠ê Add to History</button>  
          <button class="ghost" id="clearBtn">üßπ Clear</button>  
          <div style="flex:1"></div>  
          <div class="muted" id="lenInfo">0 chars</div>  
        </div>  
  
        <div class="footnote">Tip: Try "poem about rain" or "letter: say sorry to sibling". Emotion slider controls intensity.</div>  
      </div>  
  
      <!-- Right panel: history -->  
      <aside class="history" aria-label="Recent history">  
        <h3>Recent</h3>  
        <div id="historyList">  
          <!-- items inserted via JS -->  
        </div>  
        <div style="margin-top:10px; display:flex; gap:8px">  
          <button class="ghost" id="clearHistory">Clear</button>  
          <div style="flex:1"></div>  
          <div class="muted">Local only ‚Ä¢ private</div>  
        </div>  
      </aside>  
    </div>  
  </div>  
  
  <script>  
    // Simple HeartNote AI h1 ‚Äî client-side  
    (function () {  
      const modeEl = document.getElementById("mode");  
      const promptEl = document.getElementById("prompt");  
      const emotionEl = document.getElementById("emotion");  
      const emotionLabel = document.getElementById("emotionLabel");  
      const generateBtn = document.getElementById("generateBtn");  
      const outputEl = document.getElementById("output");  
      const copyBtn = document.getElementById("copyBtn");  
      const downloadBtn = document.getElementById("downloadBtn");  
      const addHistoryBtn = document.getElementById("addHistoryBtn");  
      const historyList = document.getElementById("historyList");  
      const clearHistoryBtn = document.getElementById("clearHistory");  
      const lenInfo = document.getElementById("lenInfo");  
      const saveAllBtn = document.getElementById("saveAllBtn");  
      const copyAllBtn = document.getElementById("copyAllBtn");  
  
      // local storage key  
      const STORAGE_KEY = "heartnote_h1_history";  
  
      // helpers  
      function clamp(v,min,max){ return Math.max(min, Math.min(max, v)); }  
      function nowTs(){ return new Date().toISOString(); }  
  
      // emotion label update  
      function updateEmotionLabel() {  
        const v = parseInt(emotionEl.value,10);  
        if (v < 25) emotionLabel.textContent = "Soft";  
        else if (v < 60) emotionLabel.textContent = "Balanced";  
        else emotionLabel.textContent = "Deep";  
      }  
      emotionEl.addEventListener("input", updateEmotionLabel);  
      updateEmotionLabel();  
  
      // typing effect for output (keeps HTML safe)  
     // Writing effect ‚Äî smoother, ink-like feel ‚úçÔ∏è  
async function writeEffect(html, speed = 10) {  
  const tmp = document.createElement("div");  
  tmp.innerHTML = html;  
  const text = tmp.innerText;  
  outputEl.innerHTML = ""; // clear  
  
  let i = 0;  
  const cursor = document.createElement("span");  
  cursor.textContent = "|";  
  cursor.style.animation = "blink 1s infinite";  
  cursor.style.opacity = "0.8";  
  cursor.style.color = "#ffbad2";  
  outputEl.appendChild(cursor);  
  outputEl.classList.add("handwriting");  
  
  while (i < text.length) {  
    outputEl.insertBefore(document.createTextNode(text[i]), cursor);  
    i++;  
    if (i % 3 === 0) await new Promise(r => setTimeout(r, speed * 0.8)); // smoother  
    outputEl.scrollIntoView({ behavior: "smooth", block: "end" });  
  }  
  
  cursor.remove();  
  outputEl.innerHTML = html; // restore formatted HTML  
  lenInfo.textContent = `${outputEl.innerText.length} chars`;  
}  
  
// Add blinking cursor animation to your CSS:  
const style = document.createElement("style");  
style.textContent = `  
@keyframes blink {  
  0%, 50%, 100% { opacity: 0; }  
  25%, 75% { opacity: 1; }  
}`;  
document.head.appendChild(style);  
  
      // --- Updated generation logic for HeartNote AI (Personal Writer v1) ---
function generateContent(prompt, mode, emotion) {
  prompt = (prompt || "").trim();
  const mood = clamp(parseInt(emotion, 10), 0, 100);
  const intensity = mood / 100; // 0..1

  function tone(soft, balanced, deep) {
    if (intensity < 0.3) return soft;
    if (intensity < 0.6) return balanced;
    return deep;
  }

  const topic = prompt || "today";

  // üåÖ Reflection
  if (mode === "reflection") {
    const line1 = tone(
      `Sometimes I pause and notice ${topic}, just breathing quietly.`,
      `Thinking of ${topic}, I realize how simple moments shape the day.`,
      `In ${topic}, I find echoes of what I‚Äôm still learning to understand.`
    );
    const line2 = tone(
      `Maybe it‚Äôs okay to move slowly.`,
      `Maybe calm doesn‚Äôt mean stopping ‚Äî just seeing clearly.`,
      `Even in chaos, something inside me stays gentle.`
    );
    return `<h2>üå§Ô∏è Reflection</h2><p>${line1}<br>${line2}</p>`;
  }

  // üìî Journal
  if (mode === "journal") {
    const start = tone(
      `It was a quiet day ‚Äî ${topic} stayed on my mind.`,
      `Today, ${topic} made me think about how I‚Äôm growing.`,
      `${topic} reminded me that every challenge teaches something real.`
    );
    const end = tone(
      `I‚Äôll rest tonight knowing I did enough.`,
      `Tomorrow is a new start ‚Äî I‚Äôll carry this feeling gently.`,
      `I might not have all answers, but I‚Äôm proud of how far I‚Äôve come.`
    );
    return `<h2>üìî Journal</h2><pre>${start}\n\n${end}</pre>`;
  }

  // üí¨ Note
  if (mode === "note") {
    const msg = tone(
      `Breathe ‚Äî you‚Äôre already doing enough.`,
      `Progress isn‚Äôt loud. Keep going quietly, it matters.`,
      `Your calm strength is the loudest voice in the room.`
    );
    return `<h2>üí¨ Note</h2><p>‚Äú${msg}‚Äù</p>`;
  }

  // üåø Affirmation
  if (mode === "affirmation") {
    const line = tone(
      `I‚Äôm learning to trust myself, even when I feel unsure.`,
      `I can create something good each day, no matter how small.`,
      `I‚Äôm stronger than I think ‚Äî each setback becomes direction.`
    );
    return `<h2>üåø Affirmation</h2><p>${line}</p>`;
  }

  // --- ‚úâÔ∏è Letter Mode (Focus: Functional Content and Relationship) ---
  if (mode === "letter") {
    const salutation = tone(
      `Dear Friend,`,
      `To the person who means the world to me,`,
      `My Dearest [Recipient Name/Placeholder],`
    );

    const body = tone(
      `I've been giving a lot of thought to **${topic}**. Sometimes the easiest way to solve something is just to talk about it openly. I wanted to send this note to bridge the distance and let you know that I'm here, and I genuinely care about how you feel about all of this. I believe we can work things out with a little kindness.`,
      `It's often hard to find the right words, especially when dealing with **${topic}**. I truly regret any confusion or distress I may have caused. I value our connection more than I can express, and I am focused on making things right and earning back your trust. My actions didn't reflect the respect I have for you.`,
      `In the quiet moments, all I can think about is **${topic}** and the regret that follows. I am deeply sorry. My intention was never to cause you pain, and seeing how my words/actions impacted you has given me a lot of perspective. Please know that this apology comes from the deepest part of my heart. I am committed to true change.`
    );

    const closing = tone(
      `Looking forward to better moments,`,
      `With sincerity and hope for the future,`,
      `With profound love and commitment,`
    );

    return `<h2>‚úâÔ∏è Letter (9/10 Quality)</h2><pre>${salutation}\n\n${body}\n\n${closing}</pre>`;
  }

  // --- üìù Poem Mode (Focus: Imagery, Structure, and Sophisticated Vocabulary) ---
  if (mode === "poem") {
    const verse1 = tone(
      `When **${topic}** starts to whisper near, \nLike moonlight touching the still air,`,
      `In the deep rhythm where **${topic}** resides, \nA constant tide the heart cannot refuse,`,
      `The memory of **${topic}** is a truth untold, \nA hidden seam within the soul's old fold,`
    );
    const verse2 = tone(
      `A quiet grace that pauses time,\nAnd turns the simple thought to rhyme.`,
      `It moves the spirit through calm and fire,\nWriting its own melody of desire.`,
      `It is the silence that defines the space,\nThe courageous commitment found in this place.`
    );
    
    // Use line breaks for poetic structure
    return `<h2>üìù Poem (9/10 Quality)</h2><p>${verse1}<br>${verse2}</p>`;
  }

  // --- üìö Story Mode (Focus: Narrative Arc, Character, and Specific Detail) ---
  if (mode === "story") {
    const opening = tone(
      `It began one quiet afternoon with just a small seed of an idea about **${topic}**. The protagonist, Elias, felt a faint pull toward a dream he couldn't name, a soft certainty that something significant was just beyond the horizon.`,
      `The true journey of **${topic}** wasn't easy; it started in a place of necessary conflict. Two characters, Isla and Ben, realized they could only move forward by confronting a shared past‚Äîa moment of decisive action that would define their future.`,
      `Long ago, the quest for **${topic}** was a profound, almost spiritual undertaking. It involved the hero, Kael, trekking across the Glass Mountains, driven by a solitary, burning conviction that the greatest rewards require the deepest sacrifice.`
    );
    const climax = tone(
      `The resolution arrived with a gentle understanding, proving that vulnerability is its own strength.`,
      `The climax required courage‚Äîa choice made not in comfort, but in clarity, securing the future they both needed.`,
      `And so, the profound search concluded, making the concept of **${topic}** a lasting testament to enduring human will.`
    );
    
    return `<h2>üìö Story (9/10 Quality)</h2><p>${opening}<br><br>${climax}</p>`;
  }

  // --- üíñ Quote Mode (Focus: Aphoristic Wisdom, Impact, and Clarity) ---
  if (mode === "quote") {
    const quote = tone(
      `The quiet strength of **${topic}** is in the small, consistent steps we take every day.`,
      `True alignment begins when we realize that **${topic}** is not a destination, but the compass itself.`,
      `To truly understand the depth of human connection, one must first confront the powerful truth of **${topic}**.`,
    );
    return `<h2>üíñ Quote (9/10 Quality)</h2><p>‚Äú${quote}‚Äù</p>`;
  }

  // Default prompt
  return `<p>üí≠ Try typing a few words like "a quiet morning" or "love story" to start writing.</p>`;
}
  
      // Generate button handler  
      generateBtn.addEventListener("click", async () => {  
        const prompt = promptEl.value.trim();  
        const mode = modeEl.value;  
        const emotion = emotionEl.value;  
  
        // small UX guard  
        generateBtn.disabled = true;  
        generateBtn.textContent = "Creating...";  
        const content = generateContent(prompt, mode, emotion);  
  
        // type out the content  
        await writeEffect(content, 14);  
  
        generateBtn.disabled = false;  
        generateBtn.textContent = "Generate";  
  
        // auto-add short preview to history (not saved until user presses Add)  
        // but we update len and button states  
      });  
  
      // Copy output  
      copyBtn.addEventListener("click", async () => {  
        const text = outputEl.innerText.trim();  
        if (!text) { alert("Nothing to copy."); return; }  
        try {  
          await navigator.clipboard.writeText(text);  
          copyBtn.textContent = "‚úÖ Copied";  
          setTimeout(()=>copyBtn.textContent = "üìã Copy",1400);  
        } catch(e){  
          alert("Copy failed ‚Äî your browser may block clipboard access.");  
        }  
      });  
  
      // Download .txt  
      downloadBtn.addEventListener("click", () => {  
        const txt = outputEl.innerText.trim();  
        if (!txt) { alert("Nothing to save."); return; }  
        const blob = new Blob([txt], {type:"text/plain;charset=utf-8"});  
        const url = URL.createObjectURL(blob);  
        const a = document.createElement("a");  
        a.href = url;  
        a.download = "heartnote_output.txt";  
        document.body.appendChild(a);  
        a.click();  
        a.remove();  
        URL.revokeObjectURL(url);  
      });  
  
      // Save / Copy top header buttons  
      copyAllBtn.addEventListener("click", async () => {  
        const t = outputEl.innerText.trim();  
        if (!t) return alert("No content to copy.");  
        try { await navigator.clipboard.writeText(t); alert("Copied!"); } catch { alert("Copy failed."); }  
      });  
      saveAllBtn.addEventListener("click", () => {  
        const txt = outputEl.innerText.trim();  
        if (!txt) return alert("No content to save.");  
        const blob = new Blob([txt], {type:"text/plain;charset=utf-8"});  
        const url = URL.createObjectURL(blob);  
        const a = document.createElement("a");  
        a.href = url;  
        a.download = "valantine_saved.txt";  
        document.body.appendChild(a);  
        a.click();  
        a.remove();  
        URL.revokeObjectURL(url);  
      });  
        
      document.getElementById("clearBtn").addEventListener("click", () => {  
  outputEl.innerHTML = '<div class="meta muted">Cleared. Ready for a new idea.</div>';  
  lenInfo.textContent = "0 chars";  
});  
  
      // History management  
      function loadHistory() {  
        const raw = localStorage.getItem(STORAGE_KEY);  
        let arr = [];  
        try { arr = raw ? JSON.parse(raw) : []; } catch(e){ arr = []; }  
        historyList.innerHTML = "";  
        if (!arr.length) {  
          historyList.innerHTML = `<div class="muted">No saved entries yet. Generate and "Add to History".</div>`;  
          return;  
        }  
        arr.forEach((it, idx) => {  
          const div = document.createElement("div");  
          div.className = "hist-item";  
          div.innerHTML = `<div style="flex:1"><strong style="display:block">${it.mode.toUpperCase()}</strong><div style="font-size:0.9rem;color:var(--text);margin-top:6px">${it.preview}</div></div>  
                           <div style="min-width:72px;display:flex;flex-direction:column;gap:6px">  
                             <button class="ghost" data-idx="${idx}" data-action="open">Open</button>  
                             <button class="ghost" data-idx="${idx}" data-action="delete">Delete</button>  
                           </div>`;  
          historyList.appendChild(div);  
        });  
      }  
  
      // Add to history (stores HTML + meta)  
      addHistoryBtn.addEventListener("click", () => {  
        const text = outputEl.innerText.trim();  
        if (!text) { alert("Nothing to add."); return; }  
        const mode = modeEl.value;  
        const preview = text.length > 90 ? text.slice(0,90) + "‚Ä¶" : text;  
        const raw = localStorage.getItem(STORAGE_KEY);  
        let arr = raw ? JSON.parse(raw) : [];  
        arr.unshift({ ts: nowTs(), mode, preview, text });  
        // keep 60 entries max  
        if (arr.length > 60) arr = arr.slice(0,60);  
        localStorage.setItem(STORAGE_KEY, JSON.stringify(arr));  
        loadHistory();  
        addHistoryBtn.textContent = "Saved ‚úì";  
        setTimeout(()=> addHistoryBtn.textContent = "‚≠ê Add to History",1200);  
      });  
  
      // History click handling (delegation)  
      historyList.addEventListener("click", (ev) => {  
        const btn = ev.target.closest("button[data-action]");  
        if (!btn) return;  
        const idx = parseInt(btn.dataset.idx,10);  
        const action = btn.dataset.action;  
        const raw = localStorage.getItem(STORAGE_KEY);  
        const arr = raw ? JSON.parse(raw) : [];  
        if (action === "open") {  
          const it = arr[idx];  
          if (!it) return;  
          // open in output area  
          outputEl.innerText = it.text;  
          lenInfo.textContent = `${it.text.length} chars`;  
          // set mode to the saved mode  
          if (it.mode) modeEl.value = it.mode;  
        } else if (action === "delete") {  
          if (!confirm("Delete this saved entry?")) return;  
          arr.splice(idx,1);  
          localStorage.setItem(STORAGE_KEY, JSON.stringify(arr));  
          loadHistory();  
        }  
      });  
  
      clearHistoryBtn.addEventListener("click", () => {  
        if (!confirm("Clear all saved history?")) return;  
        localStorage.removeItem(STORAGE_KEY);  
        loadHistory();  
      });  
  
      // initialize  
      loadHistory();  
  
      // small accessibility: allow Enter on prompt to generate when focused + ctrl  
      promptEl.addEventListener("keydown", (e) => {  
        if (e.key === "Enter" && (e.ctrlKey || e.metaKey)) {  
          e.preventDefault();  
          generateBtn.click();  
        }  
      });  
  
    })();
    // Theme toggle
const themeToggle = document.getElementById("themeToggle");
const userTheme = localStorage.getItem("valantine_theme");
if (userTheme === "dark") document.body.classList.add("dark");

function updateThemeIcon() {
  themeToggle.textContent = document.body.classList.contains("dark") ? "‚òÄÔ∏è" : "üåô";
}
updateThemeIcon();

themeToggle.addEventListener("click", () => {
  document.body.classList.toggle("dark");
  const isDark = document.body.classList.contains("dark");
  localStorage.setItem("valantine_theme", isDark ? "dark" : "light");
  updateThemeIcon();
});
  </script>  
</body>  
</html> 
